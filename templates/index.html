<!doctype html>
<html>
    <head>
        <title>Drone</title>
        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/mystyle.css') }}"> 
    </head>

    <script type="text/javascript">

        var socket = new WebSocket('ws://' + location.host + '/action');
        socket.addEventListener('open', function (event) {
            console.log("[open] Connection established");
        });

        socket.addEventListener('message', function (event) {
            var data = JSON.parse(event.data);
            switch(data.action){
                case 'score':
                    document.getElementById('score').textContent = + data.value + " KR";
                    break;
                case 'finish':
                    document.getElementById('surveyText').innerHTML = data.message;
                    document.getElementById('surveyModal').style.display = 'block';
                    break;
                case 'failure':
                    document.getElementById('failureText').innerHTML = data.message;
                    document.getElementById('failureAlert').style.display = 'block';
                    setTimeout(function () {
                        failureAlert.style.display = 'none';
                    }, 8000);
                    break;
                case 'welcome':
                    document.getElementById('alertText').innerHTML = data.message;
                    document.getElementById('customAlert').style.display = 'block';
                    setTimeout(function () {
                        customAlert.style.display = 'none';
                    }, 8000);
                    break;
                case 'goal':
                    document.getElementById('alertText').innerHTML = data.message;
                    document.getElementById('customAlert').style.display = 'block';
                    setTimeout(function () {
                        customAlert.style.display = 'none';
                    }, 3000);
                    break;
                default:
                    console.log("recieved unknown action type: " + data.action);
            }

        });
        function hideAllButtons(duration) {
            // Get all buttons
            var buttons = document.querySelectorAll("button");

            // Add a 'hide' class to all buttons
            buttons.forEach(function(btn) {
                btn.classList.add("hide");
            });

            // Remove the 'hide' class after duration
            setTimeout(function() {
                buttons.forEach(function(btn) {
                    btn.classList.remove("hide");
                });
            }, duration);
        }

        function sendText(actionType, parameter) {
            var message = "";
            switch(actionType) {
                case 'move':
                    message = JSON.stringify(
                        { "action": actionType, "direction": parameter }
                    );
                    hideAllButtons(2000);
                    break;
                case 'take off':
                    message = JSON.stringify(
                        { "action": actionType }
                    );

                    document.getElementById('tolBtn').value = "land";
                    document.getElementById('tolBtn').innerHTML = "Land";

                    hideAllButtons(2000);

                    break;
                case 'land':
                    message = JSON.stringify(
                        { "action": actionType }
                    );

                    document.getElementById('tolBtn').value = "Take Off";
                    document.getElementById('tolBtn').innerHTML = "Take Off";

                    hideAllButtons(2000);

                    break;
                default:
                    console.log("trying to send unknown action type: " + actionType); 
            }
            socket.send(message); // Send the text to the server
        }
    </script>
    <body>
        <div id="log"></div>
        <br>

        <div class="container">

            <div class="button-container">
                <div class="stopwatchcontainer">
                    <span id="stopwatch" >Time: --:--</span>
                </div>
                <span id="difficultyDisplay">Difficulty not set</span>

                <div class="score-container">
                    <div id="score">0</div>
                </div>


            </div>
            <div><button class="btn" onclick="sendText('move', 'forward');">Forward</button></div>
            <div class="button-container">
                <button class="btn" onclick="sendText('move', 'left');">Left</button>
                <button class="btn" onclick="sendText('move', 'right');">Right</button>
            </div>
            <div>
                <button class="btn" onclick="sendText('move', 'back');">Back</button>
            </div>


        </div>
        <div class="container">
            <div class="button-container2" id="btn2-container">
                <button class="btnTO" id="tolBtn" value="take off" onclick="sendText(this.value);">Take Off</button>
            </div>
        </div>
        <div id="customAlert" class="custom-alert">

            <div class="custom-alert-content">
                <p id="alertText"></p>
            </div>

        </div>
        <!-- The custom alert box -->
        <div id="failureAlert" class="failure-alert">

            <div class="failure-alert-content">
                <p id="failureText"></p>
            </div>

        </div>

        <!-- The survey alert box -->
        <div id="surveyModal" class="modal">
            <div class="modal-content">
                <p id="surveyText"></p>
            </div>
        </div>
        <script>
            var stopwatchDisplay = document.getElementById('stopwatch');
            var minutes = 1;
            var seconds = 30;
            // Update the stopwatch display every second
            var countdownInterval = setInterval(function() {
                if (minutes === 0 && seconds === 0) {
                    // Timer has reached 0:00, handle the countdown completion here
                    clearInterval(countdownInterval);
                    var time = padZero(minutes) + ':' + padZero(seconds);
                    stopwatchDisplay.textContent = 'Time: ' + time;
                    // Add your desired code to execute when the countdown reaches 0:00
                    stopwatchDisplay.classList.add('blinking');
                    return;
                }
                // Format the time as MM:SS
                var time = padZero(minutes) + ':' + padZero(seconds);
                // Update the stopwatch display
                stopwatchDisplay.textContent = 'Time: ' + time;
                // Decrement the seconds
                if (seconds > 0) {
                    seconds--;
                } else {
                    seconds = 59;
                    minutes--;
                }
            }, 1000);
            // Helper function to pad a single digit number with a leading zero
            function padZero(num) {
                return (num < 10 ? '0' : '') + num;
            }
        </script>
    </body>


</html>
